#!/bin/zsh
COMMAND=$1

startAppwrite() {
  docker run --rm -it \
    --volume /var/run/docker.sock:/var/run/docker.sock \
    --volume "$(pwd)"/appwrite:/usr/src/code/appwrite:rw \
    --entrypoint="install" \
    appwrite/appwrite:0.13.4
}

stopAppwrite() {
  docker-compose --file appwrite/docker-compose.yml down
}

startFrontend() {
  docker-compose up --build
}

stopFrontend() {
  docker-compose down
}

install() {
  echo "Installing appwrite cli ..."
  npm install -g appwrite-cli

  echo "Logging in to API ..."
  appwrite login

  echo "Initializing Project"
  appwrite init --all
}



# Commando functions
initServices() {
  echo "Setting up appwrite for the first time"
  startAppwrite
  install
  startFrontend
}

startServices() {
  echo "Starting services ..."
  startAppwrite
  startFrontend
}

stopServices() {
  echo "Stopping services"
  stopFrontend
  stopAppwrite
}

# Command execution
case "$COMMAND" in

up)
  initServices
  ;;
down)
  stopServices
  ;;
[iI]*)
  install
  ;;
*)
  echo "No command recognized. "
  echo "Possible commands: [up, down, login, i(nstall)]"
  ;;
esac
